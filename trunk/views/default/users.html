{{extend 'layout.html'}}

<style type="text/css">
table, td, th {border: 1px solid black;}
table{width: 100%;}
td[rowspan='2'] {text-align: center;vertical-align: middle;}
input[type=text]{width: 98%;}
//td:last-child {text-align:center;}
</style>
<script>
$(function() {
{{if auth.has_membership('Admin'):}}    
    $('.del-row').live('click', function(){
        var answer = confirm('Are you sure you want to delete this?')
        if (answer){
            $.ajax({
                url: '{{=URL('del_user')}}',
                data: 'id=' + this.name,
                context: this,
                success: function(data){
                    msg = 'The user has been successfully deleted.'
                    $(this).parent().parent().next().fadeOut(1000, function(){ $(this).remove()})
                    $(this).parent().parent().fadeOut(1000, function(){ $(this).remove()})
                    $('.flash').html(msg).slideDown(function(){ $('.flash').delay(500).fadeOut(function(){$('.flash').html('')});});
                }                
            })        
        }     
    })
{{pass}}    
});
</script>

Things to Do
<ol>
<li><del>Display all users</del></li>
<li><del>Add a user</del></li>
<li><del>Delete a user with confirmation</del></li>
<li><del>Update user</del></li>
<li><del>Only admin can delete</del></li>
</ol>

<table>
{{=TR(TH('User Management', _colspan=5))}}
{{=TR(TD(A('Add a user', _href=URL('create_user')), _colspan=5), _align='center')}}

{{for usr in usrs:}}
<tr>
{{=TD('Name:')}}
{{=TD(usr['name'])}}
{{=TD('Email:')}}
{{=TD(usr['email'])}}
{{if auth.has_membership('Admin'):}}    
{{=TD(A('Edit', _href=URL('show_user', args=usr['id'])), ' | ', A('Delete', _class='del-row', _name=usr['id']), _width='15%', _rowspan=2)}}
{{else:}}
{{=TD(A('Edit', _href=URL('show_user', args=usr['id'])), _width='15%', _rowspan=2)}}
{{pass}}
</tr>
{{=TR(TD('Groups:'), TD(usr['groups'], _colspan=3))}}
</tr>
{{pass}}

</table>
