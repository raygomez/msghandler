{{extend 'layout.html'}}
<script src="{{=URL('static','js/tagging.js')}}"></script>
<script src="{{=URL('static','js/grouping.js')}}"></script>
<script>
$(function(){
        update_tags();
        $('.tags-add').one('click', function(event){
                    $(this).parent().fadeOut( function() { $(this).remove(); update_tags();});
                    id = parseInt(this.id.split('imgt')[1]);
                    tag = {id:id, name:this.name};
                    tags.push(tag);    
                    showtags();
        });
        
        updategroups();
        $('.groups-add').one('click', function(event){
                    $(this).parent().fadeOut( function() { $(this).remove(); updategroups();});
                    id = parseInt(this.id.split('imgt')[1]);
                    group = {id:id, role:this.name};
                    groups.push(group);
                    showgroups();    
        });
        
})

</script>
{{=json}}
<h1>Message</h1>
{{=form}}

{{if len(attachments) > 0:}}
<h3>Attachments</h3>
<table>

<tr>
{{for attachment in attachments:}}
{{=TD(A(IMG(_src=URL('download',args=attachment.attachment), _alt="attachments"),
      _href=URL('download',args=attachment.attachment)))}}      
{{pass}}
</tr>
<tr>
{{for attachment in attachments:}}
<th>{{=A('Delete', _href=URL('delete_attach', args=(attachment.id, id)))}}</th>
{{pass}}
</tr>
</table>

{{pass}}

[{{=A('Attach file', _href=URL('create_attachment', args=id))}}]<br />
